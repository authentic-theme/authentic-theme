'use strict';var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i["return"])_i["return"]();}finally{if(_d)throw _e;}}return _arr;}return function(arr,i){if(Array.isArray(arr)){return arr;}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i);}else{throw new TypeError("Invalid attempt to destructure non-iterable instance");}};}();function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}var mail=function(){var _={path:{origin:v___location_origin,prefix:v___location_prefix,extensions:v___server_extensions_path,css:v___server_css_path,js:v___server_js_path},variable:{switch:function _switch(){return $t_uri_webmail;},module:{name:function name(){return v___module;},link:function link(){var prefix=v___location_prefix;return prefix?prefix+'/'+v___module:'/'+this.name();}}},content:get_pjax_content,load:load,language:theme_language,notification:theme_messenger,rows:page_table_rows_control,navigation:{reset:navigation_clear},plugin:{json_to_query:Convert.json_to_query,timestamp:time.localize,select:function select($target){var size=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'34';$target.select2({minimumResultsForSearch:5,containerCssClass:'select2-content heighter-'+size,dropdownCssClass:'select2-content h'+size});$target.next('.select2').addClass('select2-content-container');},scroll:function scroll(target,options){if(typeof target==='string'){$(target).mCustomScrollbar(options);}else{$(target[0]).mCustomScrollbar('scrollTo',target[1],{scrollOffset:[$(target[0]),3,4]});}},tooltip:function tooltip(){$('[data-tooltip="mailbox"').tooltip({html:true,trigger:'hover',container:'body',delay:{show:800,hide:30}});}}},$$={$:{layout:{container:'container-fluid',controls:'mail-controls',panel:'panel-mail panel-body',row:{controls:'row row-controls',messages:'row row-messages colorify',quota:'row row-quota'},column:{6:'col-lg-6',12:'col-lg-12'},button:{default:'btn btn-default',block:'btn btn-default btn-block',dropdown:{default:'btn btn-default dropdown-toggle'}}},tree:{container:'data-mail-folders',active:'fancytree-active',loader:'fancytree-loader'},controls:{compose:{button:'[data-compose]',icon:'fa fa-fw fa-plus'},select:{dropdown:'dropdown-select',checkbox:'[data-select] input',menus:'[data-select-mass]'},delete:'btn btn-default fa fa-trash',forward:'btn btn-default fa fa-forward',move:{dropdown:'dropdown-move',checkbox:'[data-copy-only]',icon:'fa fa-folder-move',submit:'[data-transfer-submit]'},more:{dropdown:'dropdown-more',icon:'fa fa-dots-vertical',menu:{read:'[data-form-action="markas1"]',unread:'[data-form-action="markas0"]',special:'[data-form-action="markas2"]',spam:'[data-form-action="razor"]',ham:'[data-form-action="ham"]',black:'[data-form-action="black"]',white:'[data-form-action="white"]'}},sort:{dropdown:'dropdown-sort',icon:'fa fa-fw fa-sort'},counter:'mail-selected-count',search:'btn btn-default fa fa-search',refresh:{button:'btn btn-transparent-link btn-lg btn-transparent fa fa-refresh',animation:'fa-spin-gradual'},pagination:'pagination-title',settings:'btn btn-default fa fa-cog'},mail:{checkbox:'input[data-check]',special:{star:'star',starred:'fa-star star',unstarred:'fa-star-o star'}}},create:{$:function $(classes,data){var type=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'div';var content=arguments.length>3&&arguments[3]!==undefined?arguments[3]:String();var tooltip=arguments.length>4&&arguments[4]!==undefined?arguments[4]:String();var attributes=this._attributes(data);classes=this._classes(classes);if(tooltip){tooltip='data-tooltip="mailbox" data-placement="bottom" data-title="'+tooltip+'"';}return'<'+type+' '+attributes+' '+tooltip+' class="'+classes+'">'+content+'</'+type+'>';},button:function button(classes,data,content,icon,tooltip){icon=this._classes(icon);return this.$(classes,data,'button',(icon?'<i class="'+icon+'"></i>&nbsp;&nbsp;':'')+content+'',tooltip);},checkbox:function checkbox(){var data=arguments.length>0&&arguments[0]!==undefined?arguments[0]:String();var name=arguments.length>1&&arguments[1]!==undefined?arguments[1]:String();var value=arguments.length>2&&arguments[2]!==undefined?arguments[2]:String();var label=arguments.length>3&&arguments[3]!==undefined?arguments[3]:'&nbsp;';var id=arguments.length>4&&arguments[4]!==undefined?arguments[4]:String();var attributes=this._attributes(data),input=String();input+='<span '+attributes+' class="awcheckbox awobject">';input+='<input class="iawobject" type="checkbox" name="'+name+'" value="'+value+'" id="'+id+'">';input+='<label class="lawobject" for="'+id+'">'+label+'</label>';input+='</span>';return input;},dropdown:function dropdown(classes,data,button,icon,tooltip){var dropdown=String();classes=this._classes(classes);dropdown+='<div class="btn-group '+classes+'">';if(button){if(/<[a-z][\s\S]*>/i.test(button)){dropdown+=this.$('layout.button.default',false,'span',button);}else{dropdown+=this.button('layout.button.default',false,button);}}dropdown+=this.button('layout.button.dropdown.default',{'toggle':'dropdown'},'<span class="'+(icon?$$.$.controls[icon].icon:'caret')+'"></span>',false,tooltip);dropdown+='<ul class="dropdown-menu" role="menu">';var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=data[0].entries()[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _ref=_step.value;var _ref2=_slicedToArray(_ref,2);var i=_ref2[0];var v=_ref2[1];if(v){dropdown+='<li>'+v+'</li>';}if(data[i-1]&&data[1]&&data[1]===i+1&&data[0].length>data[1]){dropdown+='<li role="separator" class="divider"></li>';}}}catch(err){_didIteratorError=true;_iteratorError=err;}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally{if(_didIteratorError){throw _iteratorError;}}}dropdown+='</ul>';dropdown+='</div>';return data[0].length?dropdown:String();},_attributes:function _attributes(data){var attributes=String();if(Array.isArray(data)){attributes=data.join(' ');}else if(data){attributes=Object.entries(data).map(function(_ref3){var _ref4=_slicedToArray(_ref3,2),k=_ref4[0],v=_ref4[1];return attributes+='data-'+k+'='+v+' ';}).slice(-1)[0];}return attributes;},_classes:function _classes(classes){return classes?classes.split('.').reduce(function(a,b){return a?a[b]:undefined;},$$.$):String();}},selector:function selector(_selector){_selector=this.create._classes(_selector);return _selector.startsWith('[')?_selector:"."+_selector.replace(/\s+/g,".");},element:function element(_element){return _element?$(this.selector(_element)):String();}};var messages=function(){var get=function get(id,folder,start){loader.start();$.post(_.path.extensions+'/mail/messages.cgi?id='+encodeURIComponent(id||String())+'&folder='+(folder||String())+'&start='+(start||String())+'&show_body_len='+preview_length()+'',function(data){render(data);});},sort=function sort(field,dir,folder,start){loader.start();$.post(''+_.variable.module.link()+'/sort.cgi?field='+encodeURIComponent(field)+'&dir='+encodeURIComponent(dir)+'&folder='+encodeURIComponent(folder)+'&start='+encodeURIComponent(start)+'',function(){get(String(),folder,start);});},loader={target:$$.selector('tree.active'),start:function start(){$(this.target).addClass($$.$.tree.loader);},end:function end(){$(this.target).removeClass($$.$.tree.loader);}},preview_length=function preview_length(){return parseInt($(window).width()/12);},storage={target:'['+$$.$.tree.container+']',counter:$$.selector('controls.counter'),get:function get(){var status=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var data=$(this.target).data('messages')||{};if(!status){data=Object.keys(data);}return data;},set:function set(id,state,status,starred,data){var storage=this.get(1);state?storage[id]=[+status,+starred]:delete storage[id];$(this.target).data('messages',storage);var selected_count=Object.keys(storage).length;$(this.counter).text((selected_count?selected_count+' '+_.language('theme_xhred_global_selected'):String()).toLowerCase());var controls=$$.selector('layout.controls');$(controls).toggleClass('hidden',!selected_count);},restore:function restore(){var data=this.get(),checkboxes=$$.$.mail.checkbox;$(checkboxes).filter(function(i,t){data.includes(t.value)&&$(t).prop('checked',1);}).promise().done(function(){$(checkboxes).trigger('change');});},reset:function reset(){var checkboxes=$$.$.mail.checkbox;$(this.target).data('messages',{});$(checkboxes+':checked').prop('checked',0).trigger('change');}},status={action:function action(_action){var string=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;_action=parseInt(_action.replace(/^\D+/g,''));if(string){return _action?'read':'unread';}return _action;},set:function set(action,messages){var $messages=$($$.$.mail.checkbox).filter(function(i,c){return messages.includes(c.value);}),$targets=$messages.parent().parents('td').parents('tr');$targets.attr('data-unread',+!this.action(action));},write:function write(data){var messages=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(messages){var action=this.action(data[0],1);messages='&d='+messages.join('&d=');$.post(_.path.extensions+'/mail/message.cgi?mark='+action+messages+'');}else{var _action2=this.action(data[0],1),server=data[1],_messages=storage.get(1),starred={read:[],unread:[]};$.each(_messages,function(i,o){if(o[1]===1){o[0]===1?starred.unread.push(i):starred.read.push(i);delete _messages[i];}});submit(server,_defineProperty({},data[0],1),Object.keys(_messages),0,1);var link=_.path.extensions+'/mail/message.cgi?mark=starred&state='+_action2+'';starred.read.length&&$.post(link+('&d='+starred.read.join('&d='))+'');starred.unread.length&&$.post(link+''+('&d='+starred.unread.join('&d='))+'');}}},events=function events(data){var button={search:$$.element('controls.search'),refresh:$$.element('controls.refresh.button'),delete:$$.element('controls.delete'),forward:$$.element('controls.forward'),special:{star:$$.selector('mail.special.star'),starred:$$.selector('mail.special.starred'),unstarred:$$.selector('mail.special.unstarred')}},dropdown={mark:{read:$$.element('controls.more.menu.read'),unread:$$.element('controls.more.menu.unread'),special:$$.element('controls.more.menu.special'),spam:$$.element('controls.more.menu.spam'),ham:$$.element('controls.more.menu.ham'),black:$$.element('controls.more.menu.black'),white:$$.element('controls.more.menu.white')},select:$$.selector('controls.select.dropdown'),move:$$.element('controls.move.dropdown')},checkbox=$($$.$.controls.select.checkbox),checkboxes=$$.$.mail.checkbox;checkbox.on('change',function(){var $this=$(this),state=$this.is(':checked');$(checkboxes).prop('checked',state).trigger('change');}).parent().parent().on('click',function(event){var $input=$(this).find('input');!$(event.target).is($input)&&$input.prop('checked',!$input.is(':checked')).trigger('change');});$(dropdown.select).find($$.$.controls.select.menus).on('click',function(event){var _$=$(event.target).data('type'),$_=$(checkboxes),$__='change',__$='checked';if(_$===5||_$===4){$_.prop(__$,_$&1).trigger($__);}else if(_$===3){$_.prop(__$,function(){return!this.checked;}).trigger($__);}else if(_$===2||_$===1){$_.prop(__$,function(){return+$(this).parents('tr').attr('data-unread')===(_$&1);}).trigger($__);}else if(_$===0){$_.prop(__$,function(){return+$(this).parents('tr').attr('data-starred')===+!(_$&1);}).trigger($__);}});$(checkboxes).on('change',function(){var $this=$(this),$row=$this.parents('td').parent('tr'),state=$this.is(':checked'),id=$this.val(),checked=checkboxes+':checked',status=$row.attr('data-unread'),starred=$row.attr('data-starred');storage.set(id,state,status,starred,data);$(checked).length===$(checkboxes).length?checkbox.prop('checked',1):checkbox.prop('checked',0);});button.delete.on('click',function(){submit(data,{'delete':1},storage.get(),1,1);});var $dropdown_move_select=dropdown.move.find('select');_.plugin.select($dropdown_move_select);$dropdown_move_select.on('change',function(){var $submit=$($$.$.controls.move.submit);$submit.toggleClass('disabled',!this.value);});dropdown.move.find('li').on('click',function(event){event.stopPropagation();var $target=$(event.target),$submit=$($$.$.controls.move.submit),$copy=$($$.$.controls.move.checkbox),copy=$copy.is(':checked');if($target.is($copy)){$submit.text(copy?_.language('theme_xhred_global_copy'):_.language('theme_xhred_global_move'));}if($target.is('button:not(.disabled)')){var _submit2;var action=copy,target=parseInt($dropdown_move_select.val());submit(data,(_submit2={},_defineProperty(_submit2,(action?'copy':'move')+'1',1),_defineProperty(_submit2,'mfolder1',target),_submit2),storage.get(),+!action||data.folder_index===target,1);dropdown.move.removeClass('open');}});button.forward.on('click',function(){_.notification(['exclamation-triangle','Forward functionality is no yet implemented. Expect it in the future beta pre-release.'],10,"info",0,1,['top','right']);});button.search.on('click',function(){_.notification(['exclamation-triangle','Search functionality is no yet implemented. Expect it in the future beta pre-release.'],10,"info",0,1,['top','right']);});button.refresh.on('click',function(){$(this).addClass($$.$.controls.refresh.animation);$$.element('tree.active').click();});$(button.special.star).on('click',function(event){event.stopImmediatePropagation();var $this=$(this),$row=$(event.target).parents('td').parent('tr'),target=$$.$.mail.special,id=$row.find('input[value]').val(),state=$(event.target).is($(button.special.starred))?1:0,unread=+$row.attr('data-unread');$row.attr('data-starred',+!state);submit(data,_defineProperty({},'markas'+(state?1:2)+'',1),[id]);$this.removeClass(target[state?'starred':'unstarred']).addClass(target[state?'unstarred':'starred']).attr('data-original-title',_.language('theme_xhred_global_'+state?'unstarred':'starred'+''));status.write([(+!unread).toString()],[id]);});dropdown.mark.read.add(dropdown.mark.unread).on('click',function(){var action=$(this).data('form-action'),messages=storage.get();status.write([action,data]);status.set(action,messages);});dropdown.mark.spam.add(dropdown.mark.ham).add(dropdown.mark.black).add(dropdown.mark.white).on('click',function(){var action=$(this).data('form-action'),messages=storage.get(),refetch=/white|black/.test(action);submit(data,_defineProperty({},action,1),messages,+refetch,1);});$($$.$.controls.compose.button).off('click');$($$.$.controls.compose.button).on('click',function(){_.content(_.variable.module.link()+'/reply_mail.cgi?new=1&folder=0');});},submit=function submit(data,actions,messages){var refetch=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var reset=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var form=data.form_list,target=_.variable.module.link()+('/'+form.target+'?'),hidden=form.hidden;hidden=_.plugin.json_to_query(hidden)+'&noredirect=0&';actions=_.plugin.json_to_query(actions);messages='&d='+messages.join('&d=');refetch&&loader.start();$.post(target+hidden+actions+messages,function(){if(reset){storage.reset();}if(refetch){$.post(_.path.extensions+'/mail/messages.cgi?'+hidden+'show_body_len='+preview_length()+'',function(data){render(data);});}});},render=function render(source){var container=$$.element('layout.container'),data=source[0],controls={select:data.form_list.buttons.select,submit:data.form_list.buttons.submit},pagination={link:data.pagination_arrow_last||data.pagination_arrow_first||String(),title:data.pagination_arrow_last?_.language('theme_xhred_mail_pagination_last'):data.pagination_arrow_first?_.language('theme_xhred_mail_pagination_first'):false},messages_list=data.list.messages?data.list.messages.replace(/�/g,''):String();container.empty().append($$.create.$('layout.panel'));var panel=container.find($$.selector('layout.panel'));if(messages_list.length>128){panel.append($$.create.$('layout.row.controls')).find($$.selector('layout.row.controls')).append($$.create.$('layout.column.6'),$$.create.$('layout.column.6')).find($$.selector('layout.column.6')).first().append($$.create.dropdown('controls.select.dropdown',[[controls.select.all,controls.select.none,controls.select.invert,controls.select.read,controls.select.unread,controls.select.special],3],$$.create.checkbox({select:1}),String(),_.language('theme_xhred_global_select')));var $form_controls=$($$.create.$('layout.controls',{'form-controls':1},'div'));Object.entries(controls.submit).map(function(_ref5){var _ref6=_slicedToArray(_ref5,2),type=_ref6[0],data=_ref6[1];var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=data.entries()[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var _ref7=_step2.value;var _ref8=_slicedToArray(_ref7,2);var i=_ref8[0];var v=_ref8[1];if(type==='buttons'){$form_controls.append($$.create.$('controls.'+v[0],{'form-control':v[0]},'span',String(),_.language('theme_xhred_global_'+v[0]+'')));}else if(type==='dropdowns'){var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=v.entries()[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var _ref9=_step3.value;var _ref10=_slicedToArray(_ref9,2);var di=_ref10[0];var dd=_ref10[1];var entries=[];var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=v[1].entries()[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var _ref11=_step4.value;var _ref12=_slicedToArray(_ref11,2);var index=_ref12[0];var _data=_ref12[1];_data[0]&&entries.push($$.create.$(0,{'form-action':_data[0]},'span',_data[1]));}}catch(err){_didIteratorError4=true;_iteratorError4=err;}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return();}}finally{if(_didIteratorError4){throw _iteratorError4;}}}if(typeof dd==="string"){$form_controls.append($$.create.dropdown('controls.'+dd+'.dropdown',[entries,2],0,dd,_.language('theme_xhred_mail_'+dd+'')||_.language('theme_xhred_global_'+dd+'')));}}}catch(err){_didIteratorError3=true;_iteratorError3=err;}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return();}}finally{if(_didIteratorError3){throw _iteratorError3;}}}}}}catch(err){_didIteratorError2=true;_iteratorError2=err;}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return();}}finally{if(_didIteratorError2){throw _iteratorError2;}}}});panel.find($$.selector('layout.column.6')).first().append($form_controls,$$.create.dropdown('controls.sort.dropdown',[[data.list.sort.date,data.list.sort.from,data.list.sort.size,data.list.sort.subject,data.list.sort.spam],5],data.list.sorted,'sort',_.language('theme_xhred_global_sort')),$$.create.$('controls.search',{'search':1},'span',String(),_.language('theme_xhred_global_search')),$$.create.$('controls.counter',false,'span')).end().last().append($$.create.$('controls.refresh.button',{'refresh':1},'span',String(),_.language('theme_xhred_global_refresh')),$$.create.$('controls.pagination',pagination.link?['href="'+pagination.link+'"','data-href="'+pagination.link+'"']:false,'a',data.pagination_message,pagination.title),data.pagination_arrow_left,data.pagination_arrow_right);panel.append($$.create.$('layout.row.messages')).find($$.selector('layout.row.messages')).append($$.create.$('layout.column.12')).find($$.selector('layout.column.12')).append(messages_list);if(data.quota){panel.append($$.create.$('layout.row.quota')).find($$.selector('layout.row.quota')).last().append($$.create.$('layout.column.12')).find($$.selector('layout.column.12')).append(data.quota);}_.plugin.timestamp();_.plugin.tooltip();_.rows();folders.set(data.folder_id);events(data);messages.storage.restore();}else{panel.append('No Mail');}loader.end();};return{get:get,sort:sort,storage:storage};}();var folders=function(){var data={file:{fancytree:'jquery.fancytree'},selector:{navigation:'aside .navigation'},options:{tree:{escapeTitles:false,autoActivate:false,autoScroll:true,keyboard:false,toggleEffect:false},scroll:{axis:'xy',theme:'minimal',keyboard:false,scrollInertia:300,scrollButtons:true,autoHideScrollbar:false}},plugin:{tree:function tree(source){source=source==='get'?'getTree':source==='node'?'getActiveNode':Object.assign(data.options.tree,{source:source,click:function click(e,d){if(d.targetType==='title'){setTimeout(function(){_tree.adjust();},1e2);_.content(data.url.link+encodeURIComponent(d.node.key));messages.storage.reset();_.navigation.reset();}}});return $(_tree.container).fancytree(source);}},url:{link:_.path.origin+_.path.prefix+'/mailbox/index.cgi?id='}};var _tree={fetched:0,container:'['+$$.$.tree.container+']',container_adjust:function container_adjust(){var container=$(this.container+' >:first'),content=$(this.container+' >>:first');if(container.height()>content.height()){container.css('height',content.height());}},init:function init(source){if(this.fetched===0){this.load();return;}if($(data.selector.navigation+' '+this.container).length===0){$(data.selector.navigation).prepend('<li><div '+$$.$.tree.container+'></div></li>');$(data.selector.navigation).prepend('<li>'+$$.create.$('layout.button.block',{'compose':1},'span',$$.create.$('controls.compose.icon',false,'i')+" "+_.language('theme_xhred_mail_new_message'))+'</li>');}else{return;}data.plugin.tree(source);_.plugin.scroll(this.container,data.options.scroll);this.container_adjust();},expand:function expand(node){var expanded=node.isExpanded();!expanded&&node.toggleExpanded();},load:function load(){this.fetched=1;_.load.bundle(_.path.js+'/'+data.file.fancytree,_.path.css+'/'+data.file.fancytree,_.variable.switch()?[get]:0,1);},reload:function reload(source){var _this=this;var tree=data.plugin.tree('get');tree.$container.empty();tree.reload(source);setTimeout(function(){_this.adjust();},1e2);},node:function node(){return data.plugin.tree('node');},adjust:function adjust(){var $_=this.node();if($_&&$_.li&&$($_.li).length){_.plugin.scroll([this.container,$($_.li)]);}this.container_adjust();}};var get=function get(key){key=key?'?key='+key.replace(/&/g,'%26'):String();$.post(_.path.extensions+'/mail/folders.cgi'+key+'',function(source){if(!!key){_tree.reload(source);}else{_tree.init(source);}});};var set=function set(key){var tree=data.plugin.tree('get');tree.activateKey(key);};var adjust=function adjust(){_tree.adjust();};return{get:get,set:set,adjust:adjust};}();return{folders:{get:folders.get,set:folders.set,adjust:folders.adjust},messages:{get:messages.get,sort:messages.sort}};}();
